<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>ヒット＆ブロー</title>
    <style>
      span {
        margin: 5px;
        padding: 0px 10px;
        border: thin solid #cccccc;
      }

      #answer {
        font-size: 60px;
      }

      #number {
        font-size: 40px;
      }

      .red {
        background-color: #ffcccc;
      }

      .magenta {
        background-color: #ffccff;
      }

      .cyan {
        background-color: #ccffff;
      }

      .green {
        background-color: #ccffcc;
      }

      .yellow {
        background-color: #ffffcc;
      }
    </style>
  </head>

  <body onload="init()">
    <p>ヒット＆ブロー</p>
    <input type="button" value="新しい問題" onclick="newQuestion()" />
    <hr />
    <div id="number"></div>
    <hr />
    !Drag &amp; Drop
    <div id="answer"></div>
    <hr />
    <input type="button" value="判定" onclick="check()" />
    <input type="button" value="リセット" onclick="reset()" />
    <div id="log"></div>
  </body>

  <script>
    const qNumber = Array.from({ length: 4 });
    const aNumber = Array.from({ length: 4 });
    let cnt = 0;

    function init() {
      document.getElementById("number").innerHTML = "";
      for (let i = 0; i < 10; i++) {
        const number = document.createElement("span");
        number.innerText = i;
        number.className = "yellow";
        number.draggable = true;
        number.ondragstart = dragNumber;
        document.getElementById("number").appendChild(number);
      }

      document.getElementById("answer").innerHTML = "";

      for (let i = 0; i < 4; i++) {
        const answer = document.createElement("span");
        answer.id = `a_${i}`;
        answer.innerText = 0;
        answer.ondragover = dragOverNumber;
        answer.ondrop = dropNumber;
        document.getElementById("answer").appendChild(answer);
      }

      setQuestion();
    }

    function setQuestion() {
      const numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
      for (let i = 9; i > 0; i--) {
        const j = Math.floor(Math.random() * i);
        const tempNumber = numbers[i];
        numbers[i] = numbers[j];
        numbers[j] = tempNumber;
      }

      for (let i = 0; i < 4; i++) qNumber[i] = numbers[i];
    }

    function dragNumber(event) {
      event.dataTransfer.setData("text", event.target.innerText);
    }

    function dropNumber(event) {
      const number = event.dataTransfer.getData("text");
      event.target.innerText = number;
      event.target.className = "";
    }

    function dragOverNumber(event) {
      event.preventDefault();
    }

    function check() {
      let answer = "";
      for (let i = 0; i < 4; i++) {
        answer += document.getElementById(`a_${i}`).innerText;
        aNumber[i] = Number(document.getElementById(`a_${i}`).innerText);
      }

      let hit = 0;
      let blow = 0;
      for (let i = 0; i < 4; i++) {
        if (aNumber.includes(qNumber[i])) {
          if (aNumber[i] === qNumber[i]) {
            hit++;
          } else {
            blow++;
          }
        }
      }

      let style = "red";
      if (blow > 0) style = "magenta";
      if (hit > 0) style = "cyan";
      if (hit === 4) style = "green";
      for (let i = 0; i < 4; i++) {
        document.getElementById(`a_${i}`).className = style;
      }

      cnt++;
      let log = document.getElementById("log").innerHTML;
      answer = `${cnt}回目：[${answer}]：`;
      if (hit === 4) {
        log = `${answer}正解！<br>${log}`;
      } else {
        log = `${answer + hit}ヒット、${blow}ブロー<br>${log}`;
      }
      document.getElementById("log").innerHTML = log;
    }

    function reset() {
      cnt = 0;
      for (let i = 0; i < 4; i++) {
        document.getElementById(`a_${i}`).innerText = 0;
        document.getElementById(`a_${i}`).className = "";
      }
      document.getElementById("log").innerHTML = "";
    }

    function newQuestion() {
      reset();
      setQuestion();
    }
  </script>
</html>
